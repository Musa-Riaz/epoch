# Email Invitation System - Architecture & Flow Diagrams

## ğŸ“Š System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Next.js)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Manager Dashboardâ”‚     â”‚ Accept Invitationâ”‚                â”‚
â”‚  â”‚                  â”‚     â”‚      Page        â”‚                â”‚
â”‚  â”‚ - Create Project â”‚     â”‚                  â”‚                â”‚
â”‚  â”‚ - Add Emails     â”‚     â”‚ - View Details   â”‚                â”‚
â”‚  â”‚ - Send Invites   â”‚     â”‚ - Accept/Decline â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                         â”‚                          â”‚
â”‚           â”‚                         â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚     ProjectInvitations Component          â”‚                â”‚
â”‚  â”‚                                            â”‚                â”‚
â”‚  â”‚  - Email Validation                        â”‚                â”‚
â”‚  â”‚  - Bulk Management                         â”‚                â”‚
â”‚  â”‚  - Status Tracking                         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTP/REST API
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVER (Express + Node.js)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Invitation Routes                         â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚  POST   /api/invitations/send                         â”‚   â”‚
â”‚  â”‚  GET    /api/invitations/token/:token                 â”‚   â”‚
â”‚  â”‚  POST   /api/invitations/accept                       â”‚   â”‚
â”‚  â”‚  GET    /api/invitations/project/:projectId           â”‚   â”‚
â”‚  â”‚  DELETE /api/invitations/:invitationId                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                        â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Invitation Controller                        â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚  â€¢ sendProjectInvitations()                           â”‚   â”‚
â”‚  â”‚  â€¢ getInvitationByToken()                             â”‚   â”‚
â”‚  â”‚  â€¢ acceptInvitation()                                 â”‚   â”‚
â”‚  â”‚  â€¢ getProjectInvitations()                            â”‚   â”‚
â”‚  â”‚  â€¢ cancelInvitation()                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚                                  â”‚                    â”‚
â”‚       â”‚                                  â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Email Service  â”‚              â”‚   Database     â”‚         â”‚
â”‚  â”‚   (Nodemailer)  â”‚              â”‚   (MongoDB)    â”‚         â”‚
â”‚  â”‚                 â”‚              â”‚                â”‚         â”‚
â”‚  â”‚ â€¢ Send Invites  â”‚              â”‚ â€¢ Invitations  â”‚         â”‚
â”‚  â”‚ â€¢ Send Welcome  â”‚              â”‚ â€¢ Projects     â”‚         â”‚
â”‚  â”‚ â€¢ Templates     â”‚              â”‚ â€¢ Users        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Email Provider    â”‚
â”‚                    â”‚
â”‚  â€¢ Gmail           â”‚
â”‚  â€¢ SendGrid        â”‚
â”‚  â€¢ AWS SES         â”‚
â”‚  â€¢ Ethereal        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Invitation Flow - New User

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Manager â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Creates project with emails
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   POST /send       â”‚
â”‚   Backend API      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Check if user exists
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User.findOne()    â”‚â—„â”€â”€â”€ Email: newuser@test.com
â”‚  Result: null      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. User not found
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Invitation  â”‚
â”‚                    â”‚
â”‚ â€¢ Generate Token   â”‚â—„â”€â”€â”€ crypto.randomBytes(32)
â”‚ â€¢ Set Expiry       â”‚â—„â”€â”€â”€ 7 days from now
â”‚ â€¢ Save to DB       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Send invitation email
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sendInvitationEmail()
â”‚                    â”‚
â”‚ â€¢ Subject: Join Project
â”‚ â€¢ HTML Template    â”‚
â”‚ â€¢ Invitation Link  â”‚â—„â”€â”€â”€ /accept-invitation?token=xyz
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. Email delivered
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User's Inbox      â”‚
â”‚                     â”‚
â”‚   ğŸ“§ [Open Email]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 6. Clicks link
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Accept Invitation    â”‚
â”‚       Page           â”‚
â”‚                      â”‚
â”‚ â€¢ Shows project      â”‚
â”‚ â€¢ Shows inviter      â”‚
â”‚ â€¢ Expiry date        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 7. Not logged in
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redirect to Login  â”‚
â”‚                      â”‚
â”‚ â€¢ Save token         â”‚â—„â”€â”€â”€ localStorage
â”‚ â€¢ Show message       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 8. User signs up
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Create Account     â”‚
â”‚                      â”‚
â”‚ â€¢ Email must match   â”‚â—„â”€â”€â”€ newuser@test.com
â”‚ â€¢ Password set       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 9. Logged in, retrieve token
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Back to Accept Page  â”‚
â”‚                      â”‚
â”‚ â€¢ Token validated    â”‚
â”‚ â€¢ Email verified     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 10. Click "Accept"
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /accept        â”‚
â”‚                      â”‚
â”‚ â€¢ Validate token     â”‚
â”‚ â€¢ Check expiration   â”‚
â”‚ â€¢ Verify email       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 11. Add to project
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Project      â”‚
â”‚                      â”‚
â”‚ project.team.push()  â”‚â—„â”€â”€â”€ Add user ID
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 12. Mark invitation
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Invitation   â”‚
â”‚                      â”‚
â”‚ status: 'accepted'   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 13. Send welcome email
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sendWelcomeEmail()   â”‚
â”‚                      â”‚
â”‚ â€¢ Confirmation       â”‚
â”‚ â€¢ Project link       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 14. Redirect
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Member Dashboard    â”‚
â”‚                      â”‚
â”‚ âœ… Project visible   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Invitation Flow - Existing User

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Manager â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Creates project with emails
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   POST /send       â”‚
â”‚   Backend API      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Check if user exists
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User.findOne()    â”‚â—„â”€â”€â”€ Email: existing@test.com
â”‚  Result: User obj  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. User found!
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add to Project     â”‚
â”‚   Directly         â”‚
â”‚                    â”‚
â”‚ project.team.push()â”‚â—„â”€â”€â”€ Add user ID immediately
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. No invitation needed
     â”‚
     â”‚ 5. Send welcome email
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sendWelcomeEmail() â”‚
â”‚                    â”‚
â”‚ â€¢ You've joined    â”‚
â”‚ â€¢ Project link     â”‚
â”‚ â€¢ No token         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Email delivered
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User's Inbox      â”‚
â”‚                     â”‚
â”‚   ğŸ“§ [Open Email]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 7. Opens email
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Welcome Email       â”‚
â”‚                      â”‚
â”‚ "You've been added!" â”‚
â”‚ [Go to Dashboard]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 8. Clicks link
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Member Dashboard    â”‚
â”‚                      â”‚
â”‚ âœ… Project visible   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Token Generation & Validation

```
GENERATION (Backend)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. crypto.randomBytes(32)
        â”‚
        â–¼
   [32 random bytes]
        â”‚
        â–¼
   .toString('hex')
        â”‚
        â–¼
 64-character token
 "a1b2c3d4e5f6..."
        â”‚
        â–¼
  Save to DB with:
  â€¢ email
  â€¢ projectId
  â€¢ invitedBy
  â€¢ status: 'pending'
  â€¢ expiresAt: +7 days


VALIDATION (Backend)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User clicks link with token
        â”‚
        â–¼
GET /token/:token
        â”‚
        â–¼
Find invitation by token
        â”‚
        â”œâ”€â–º Not found? â†’ Error: "Invalid token"
        â”‚
        â–¼
Check status
        â”‚
        â”œâ”€â–º Not 'pending'? â†’ Error: "Already used/expired"
        â”‚
        â–¼
Check expiration
        â”‚
        â”œâ”€â–º Past expiresAt? â†’ Error: "Invitation expired"
        â”‚
        â–¼
Check email match
        â”‚
        â”œâ”€â–º Different email? â†’ Error: "Email mismatch"
        â”‚
        â–¼
âœ… Valid! Proceed with acceptance
```

## ğŸ“§ Email Template Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   EPOCH                      âœ‰ï¸   â”‚ â”‚
â”‚ â”‚   Gradient Header (Blueâ†’Indigo)   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â”‚
â”‚   You're Invited!                     â”‚
â”‚                                       â”‚
â”‚   [Inviter Name] has invited you to  â”‚
â”‚   join [Project Name]                 â”‚
â”‚                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  ğŸ“ Project Name            â”‚    â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚    â”‚
â”‚   â”‚  Description text...        â”‚    â”‚
â”‚   â”‚                             â”‚    â”‚
â”‚   â”‚  ğŸ‘¤ Invited by: John Doe    â”‚    â”‚
â”‚   â”‚  ğŸ“… Expires: Jan 15, 2024   â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚    Accept Invitation  â¡ï¸     â”‚    â”‚
â”‚   â”‚   [Button - Blue Gradient]   â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                       â”‚
â”‚   This invitation expires in 7 days  â”‚
â”‚                                       â”‚
â”‚   If you didn't expect this...       â”‚
â”‚                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚   Â© 2024 Epoch                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Project        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ _id: ObjectId       â”‚
â”‚ name: string        â”‚
â”‚ description: string â”‚
â”‚ owner: ObjectId â”€â”€â”€â”€â”¼â”€â”€â”
â”‚ team: ObjectId[] â”€â”€â”€â”¼â”€â”â”‚
â”‚ status: string      â”‚ â”‚â”‚
â”‚ deadline: Date      â”‚ â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
                        â”‚â”‚
                        â”‚â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”¼â”€â”€â”
â”‚    Invitation         â”‚â””â”€â”€â”¼â”€â”€â”
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚  â”‚
â”‚ _id: ObjectId         â”‚   â”‚  â”‚
â”‚ email: string         â”‚   â”‚  â”‚
â”‚ projectId: ObjectId â”€â”€â”¼â”€â”€â”€â”˜  â”‚
â”‚ token: string (unique)â”‚      â”‚
â”‚ invitedBy: ObjectId â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ status: enum          â”‚      â”‚
â”‚ expiresAt: Date       â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                               â”‚
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚        User                   
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        
â”‚ _id: ObjectId                 
â”‚ email: string (unique)        
â”‚ firstName: string             
â”‚ lastName: string              
â”‚ role: enum                    
â”‚ password: string (hashed)     
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        
```

## ğŸ” Status Flow Diagram

```
Invitation Status Lifecycle
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    [Created]
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ PENDING  â”‚â—„â”€â”€â”€ Initial state
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€â”€â–º User accepts â”€â”€â”€â”€â–º [ACCEPTED]
        â”‚
        â”œâ”€â”€â”€â”€â–º 7 days pass â”€â”€â”€â”€â–º [EXPIRED]
        â”‚
        â””â”€â”€â”€â”€â–º Manager cancels â”€â–º [REJECTED]


Project Member States
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  New User                 Existing User
     â”‚                          â”‚
     â–¼                          â–¼
[NOT IN PROJECT]         [NOT IN PROJECT]
     â”‚                          â”‚
     â”‚ Invited                  â”‚ Invited
     â–¼                          â”‚
[PENDING INVITATION]            â”‚
     â”‚                          â”‚
     â”‚ Accepts                  â”‚ Auto-added
     â–¼                          â–¼
[IN PROJECT.TEAM]          [IN PROJECT.TEAM]
     â”‚                          â”‚
     â–¼                          â–¼
[CAN ACCESS PROJECT]       [CAN ACCESS PROJECT]
```

## ğŸš¦ Error Handling Flow

```
API Call: POST /accept
         â”‚
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Middlewareâ”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â–º No auth token? â”€â”€â”€â”€â–º 401 Unauthorized
        â”‚
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Controllerâ”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â–º No token param? â”€â”€â”€â–º 400 Bad Request
        â”‚
        â–¼
  Find Invitation
        â”‚
        â”œâ”€â–º Not found? â”€â”€â”€â”€â”€â”€â”€â”€â–º 404 Not Found
        â”‚                        "Invalid token"
        â–¼
  Check Status
        â”‚
        â”œâ”€â–º Already used? â”€â”€â”€â”€â”€â–º 400 Bad Request
        â”‚                        "Already accepted"
        â–¼
  Check Expiration
        â”‚
        â”œâ”€â–º Expired? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º 400 Bad Request
        â”‚                        "Invitation expired"
        â–¼
  Verify Email
        â”‚
        â”œâ”€â–º Email mismatch? â”€â”€â”€â–º 403 Forbidden
        â”‚                        "Wrong email"
        â–¼
  Add to Project
        â”‚
        â”œâ”€â–º Project not found? â–º 404 Not Found
        â”‚
        â”œâ”€â–º Already in team? â”€â”€â–º 400 Bad Request
        â”‚                        "Already member"
        â–¼
  Send Welcome Email
        â”‚
        â”œâ”€â–º Email fails? â”€â”€â”€â”€â”€â”€â–º Log error
        â”‚                        (Still succeed)
        â–¼
   200 Success!
   âœ… "Joined project"
```

## ğŸ“± Component Interaction

```
Manager Dashboard
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  New Project Dialog                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Name: [____________]         â”‚  â”‚
â”‚  â”‚ Description: [__________]    â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚ Invite Members:              â”‚  â”‚
â”‚  â”‚ [email@test.com        ] [+] â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚ Added:                       â”‚  â”‚
â”‚  â”‚ â€¢ user1@test.com       [x]   â”‚  â”‚
â”‚  â”‚ â€¢ user2@test.com       [x]   â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚ [Create Project]             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ On Create
               â–¼
      API: POST /projects
               â”‚
               â”œâ”€â–º Create project
               â”‚
               â–¼
      API: POST /invitations/send
               â”‚
               â”œâ”€â–º Process emails
               â”‚
               â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Results Dialog  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ âœ… user1 added  â”‚
      â”‚ âœ… user2 invitedâ”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ProjectInvitations Component
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Invite Team Members               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Email: [____________] [Add]  â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚ To Invite:                   â”‚  â”‚
â”‚  â”‚ â€¢ new@test.com         [x]   â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚ [Send 1 Invitation]          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚
â”‚  Pending Invitations               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“§ invite@test.com           â”‚  â”‚
â”‚  â”‚ Sent: Jan 8 | Exp: Jan 15    â”‚  â”‚
â”‚  â”‚ [Pending] [Cancel]           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Security Layers

```
Level 1: Token Security
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Cryptographically random (crypto.randomBytes)
â€¢ 64 characters long
â€¢ Unique in database
â€¢ One-time use

Level 2: Time-based
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ 7-day expiration
â€¢ Checked on every use
â€¢ Expired = invalid

Level 3: Email Verification
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Must match invited email
â€¢ Case-insensitive
â€¢ Checked on acceptance

Level 4: Database Validation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Compound index (email + project)
â€¢ No duplicate invitations
â€¢ Status tracking

Level 5: Authentication
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ JWT required for acceptance
â€¢ User must be logged in
â€¢ Protected routes

Level 6: Authorization
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Only inviter can cancel
â€¢ Only invited user can accept
â€¢ Project owner checks
```

---

## ğŸ“– Legend

```
â”Œâ”€â”€â”€â”€â”€â”
â”‚ Box â”‚   = Process/Component
â””â”€â”€â”€â”€â”€â”˜

   â”‚
   â–¼      = Flow direction

â”€â”€â”€â–º      = Conditional path

[Text]    = Action/Button

â—„â”€â”€â”€      = Reference/Link

âœ…         = Success state
âŒ         = Error state
ğŸ“§         = Email
ğŸ”         = Security
```

---

This diagram shows the complete architecture and flow of the invitation system. Use it as a reference for understanding how all components work together!
